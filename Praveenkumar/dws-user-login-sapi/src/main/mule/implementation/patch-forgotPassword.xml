<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
	<sub-flow name="patch-forgotPassword-flow" doc:id="a9a6caa8-07c3-48f0-a12c-429b6ed46ce7" >
		<logger level="INFO" doc:name="Start Forgot Password Process" doc:id="6ab47701-dab1-4b9d-8f58-6df667a06234" message="*** Received request to reset password for email: #[payload.email] | CorrelationId: #[correlationId] ***"/>
		<until-successful maxRetries="${untilSuccess.maxRetries}" doc:name="Until Successful" doc:id="82c8dc5b-6965-4e29-80cd-c6790f29299b" millisBetweenRetries="${untilSuccess.retriesTime}" >
			<db:update doc:name="Update Password if forgot" doc:id="d1acaca4-8c3c-48be-8a78-9112658ed85c" config-ref="Database_Config">
			<db:sql><![CDATA[${database_query.updateForgotPassword}]]></db:sql>
				<db:input-parameters><![CDATA[#[{
	email : payload.email,
	password: payload.newPassword
}]]]></db:input-parameters>
		</db:update>
		</until-successful>
		<logger level="INFO" doc:name="End Forgot Password Process" doc:id="56b3a064-e47b-4390-ad3f-123260ad11ce" message="*** Password reset completed successfully | CorrelationId: #[correlationId] ***"/>
	</sub-flow>
</mule>
